<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>معلومات النموذج</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
    {% include 'navbar.html' %}

    <div class="main-container">
        <div class="page-header">
            <h1><i class="bi bi-info-circle" style="color: #667eea; margin-left: 10px;"></i> معلومات النموذج</h1>
            <p class="page-subtitle">عرض ملخص البيانات، مقاييس الأداء ومعاملات الانحدار</p>
        </div>

        <div id="loading" class="loading text-center">
            <div class="spinner-border" role="status"><span class="visually-hidden">Loading...</span></div>
            <div class="loading-text mt-2">جاري جلب بيانات النموذج...</div>
        </div>

        <div id="content" style="display:none;">
            <div id="error" style="display:none;"></div>

            <div class="card mb-3">
                <div class="card-header"><strong>ملخص البيانات</strong></div>
                <div class="card-body" id="dataSummary"></div>
            </div>

            <div class="card mb-3">
                <div class="card-header"><strong>مقاييس الأداء</strong></div>
                <div class="card-body" id="metricsArea"></div>
            </div>

            <div class="card mb-3">
                <div class="card-header"><strong>معاملات الانحدار (Regression Coefficients)</strong></div>
                <div class="card-body">
                    <div id="coeffTable"></div>
                </div>
            </div>

        </div>
    </div>

<script>
    async function loadModelInfo() {
        try {
            const res = await fetch('/model-info-data');
            const data = await res.json();
            document.getElementById('loading').style.display = 'none';

            if (!data.success) {
                document.getElementById('error').style.display = 'block';
                document.getElementById('error').innerHTML = `<div class="alert alert-danger">خطأ: ${data.error}</div>`;
                return;
            }

            // summary
            const s = data.summary;
            document.getElementById('dataSummary').innerHTML = `
                <div>عدد الصفوف: <strong>${s.rows.toLocaleString('en-US')}</strong></div>
                <div>عدد الأعمدة: <strong>${s.columns.toLocaleString('en-US')}</strong></div>
                <div>متوسط السعر (target mean): <strong>$${s.target_mean.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}</strong></div>
                <div>انحراف معياري للسعر: <strong>${s.target_std.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}</strong></div>
            `;

            // metrics (عرض MAE, MSE, RMSE, MAPE)
            const m = data.metrics;
            document.getElementById('metricsArea').innerHTML = `
                <div>MAE: <strong>${m.mae !== undefined ? '$' + m.mae.toLocaleString('en-US', {minimumFractionDigits: 3, maximumFractionDigits: 3}) : 'N/A'}</strong></div>
                <div>MSE: <strong>${m.mse !== undefined ? '$' + m.mse.toLocaleString('en-US', {minimumFractionDigits: 3, maximumFractionDigits: 3}) : 'N/A'}</strong></div>
                <div>RMSE: <strong>${m.rmse !== undefined ? '$' + m.rmse.toLocaleString('en-US', {minimumFractionDigits: 3, maximumFractionDigits: 3}) : 'N/A'}</strong></div>
                <div>MAPE: <strong>${m.mape === null || m.mape === undefined ? 'N/A' : m.mape.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2}) + '%'}</strong></div>
            `;

            // coefficients table
            const coeffs = data.coefficients || [];
            const cols = data.feature_columns || [];
            let tableHtml = '<table class="table table-striped"><thead><tr><th>المتغير</th><th>المعامل</th></tr></thead><tbody>';
            for (let i=0;i<cols.length;i++){
                const val = coeffs[i] !== undefined ? coeffs[i].toLocaleString('en-US', {minimumFractionDigits: 6, maximumFractionDigits: 6}) : 'N/A';
                tableHtml += `<tr><td>${cols[i]}</td><td>${val}</td></tr>`;
            }
            tableHtml += '</tbody></table>';
            if (data.intercept !== null) {
                tableHtml += `<div>Intercept: <strong>${data.intercept.toLocaleString('en-US', {minimumFractionDigits: 6, maximumFractionDigits: 6})}</strong></div>`;
            }

            document.getElementById('coeffTable').innerHTML = tableHtml;

            document.getElementById('content').style.display = 'block';

        } catch (err) {
            document.getElementById('loading').style.display = 'none';
            document.getElementById('error').style.display = 'block';
            document.getElementById('error').innerHTML = `<div class="alert alert-danger">حدث خطأ: ${err.message}</div>`;
        }
    }

    window.addEventListener('load', loadModelInfo);
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
