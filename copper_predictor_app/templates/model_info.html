<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù†Ù…ÙˆØ°Ø¬</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
    {% include 'navbar.html' %}

    <div class="main-container">
        <div class="page-header">
            <h1>ğŸ“š Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù†Ù…ÙˆØ°Ø¬</h1>
            <p class="page-subtitle">Ø¹Ø±Ø¶ Ù…Ù„Ø®Øµ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŒ Ù…Ù‚Ø§ÙŠÙŠØ³ Ø§Ù„Ø£Ø¯Ø§Ø¡ ÙˆÙ…Ø¹Ø§Ù…Ù„Ø§Øª Ø§Ù„Ø§Ù†Ø­Ø¯Ø§Ø±</p>
        </div>

        <div id="loading" class="loading text-center">
            <div class="spinner-border" role="status"><span class="visually-hidden">Loading...</span></div>
            <div class="loading-text mt-2">Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù†Ù…ÙˆØ°Ø¬...</div>
        </div>

        <div id="content" style="display:none;">
            <div id="error" style="display:none;"></div>

            <div class="card mb-3">
                <div class="card-header"><strong>Ù…Ù„Ø®Øµ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</strong></div>
                <div class="card-body" id="dataSummary"></div>
            </div>

            <div class="card mb-3">
                <div class="card-header"><strong>Ù…Ù‚Ø§ÙŠÙŠØ³ Ø§Ù„Ø£Ø¯Ø§Ø¡</strong></div>
                <div class="card-body" id="metricsArea"></div>
            </div>

            <div class="card mb-3">
                <div class="card-header"><strong>Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø§Ù„Ø§Ù†Ø­Ø¯Ø§Ø± (Regression Coefficients)</strong></div>
                <div class="card-body">
                    <div id="coeffTable"></div>
                </div>
            </div>

        </div>
    </div>

<script>
    async function loadModelInfo() {
        try {
            const res = await fetch('/model-info-data');
            const data = await res.json();
            document.getElementById('loading').style.display = 'none';

            if (!data.success) {
                document.getElementById('error').style.display = 'block';
                document.getElementById('error').innerHTML = `<div class="alert alert-danger">Ø®Ø·Ø£: ${data.error}</div>`;
                return;
            }

            // summary
            const s = data.summary;
            document.getElementById('dataSummary').innerHTML = `
                <div>Ø¹Ø¯Ø¯ Ø§Ù„ØµÙÙˆÙ: <strong>${s.rows}</strong></div>
                <div>Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø©: <strong>${s.columns}</strong></div>
                <div>Ù…ØªÙˆØ³Ø· Ø§Ù„Ø³Ø¹Ø± (target mean): <strong>$${s.target_mean.toFixed(2)}</strong></div>
                <div>Ø§Ù†Ø­Ø±Ø§Ù Ù…Ø¹ÙŠØ§Ø±ÙŠ Ù„Ù„Ø³Ø¹Ø±: <strong>${s.target_std.toFixed(2)}</strong></div>
            `;

            // metrics (Ø¹Ø±Ø¶ MAE, MSE, RMSE, MAPE)
            const m = data.metrics;
            document.getElementById('metricsArea').innerHTML = `
                <div>MAE: <strong>${m.mae !== undefined ? '$' + m.mae.toFixed(3) : 'N/A'}</strong></div>
                <div>MSE: <strong>${m.mse !== undefined ? '$' + m.mse.toFixed(3) : 'N/A'}</strong></div>
                <div>RMSE: <strong>${m.rmse !== undefined ? '$' + m.rmse.toFixed(3) : 'N/A'}</strong></div>
                <div>MAPE: <strong>${m.mape === null || m.mape === undefined ? 'N/A' : m.mape.toFixed(2) + '%'}</strong></div>
            `;

            // coefficients table
            const coeffs = data.coefficients || [];
            const cols = data.feature_columns || [];
            let tableHtml = '<table class="table table-striped"><thead><tr><th>Ø§Ù„Ù…ØªØºÙŠØ±</th><th>Ø§Ù„Ù…Ø¹Ø§Ù…Ù„</th></tr></thead><tbody>';
            for (let i=0;i<cols.length;i++){
                const val = coeffs[i] !== undefined ? coeffs[i].toFixed(6) : 'N/A';
                tableHtml += `<tr><td>${cols[i]}</td><td>${val}</td></tr>`;
            }
            tableHtml += '</tbody></table>';
            if (data.intercept !== null) {
                tableHtml += `<div>Intercept: <strong>${data.intercept.toFixed(6)}</strong></div>`;
            }

            document.getElementById('coeffTable').innerHTML = tableHtml;

            document.getElementById('content').style.display = 'block';

        } catch (err) {
            document.getElementById('loading').style.display = 'none';
            document.getElementById('error').style.display = 'block';
            document.getElementById('error').innerHTML = `<div class="alert alert-danger">Ø­Ø¯Ø« Ø®Ø·Ø£: ${err.message}</div>`;
        }
    }

    window.addEventListener('load', loadModelInfo);
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
